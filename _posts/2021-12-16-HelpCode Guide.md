---
title: HelpCode Guide
author: study875
date: 2021-12-16
category: qinglong
layout: post
---

## 前言

首先感谢 TG 频道“互助研究院”不断更新的代码，让我们的 CK 互助有了更丰富、更有趣的玩法。在写本文过程中，得到了 Andy Woo 大佬、小姐姐 LAzySheep 以及“互助研究院”频道成员的大力支持，这里表示感谢。

这里需要使用到频道提供的核心文件：

### ● code.sh

基于青龙 2.2.0 的 code.sh 修改而来，仅支持 2.8.0 及以上版本的青龙，不支持 2.2.0及以下版本的青龙。

**主要功能：**

①批量格式化导出互助码和互助规则；包括东东农场、京喜工厂、摇钱树等十几个个活动的互助码收集和整理。其中：

a\) 口袋书店已经下线；

b\) 京喜农场已经数月抢不到种子等同于已下线；

c\) 京东赚赚、疯狂的Joy不再支持互助；

d\) 城城领现金、手机狂欢城为购物节等特殊时期才会上架的活动；

e\) 京喜 Token 自京喜财富岛活动重新上架后已无导出必要。

②支持自定义互助规则模板；

③支持指定活动采用指定互助模板；

④支持临时屏蔽某账号被助力(这些账号仍可助力其他账号)；

⑤支持自动静默安装或静默修复常用的 node 依赖包(支持自定义所需要安装的依赖包)；

⑥支持 Cookie 批量格式化导出。

### ● task_before.sh

**主要功能：**

包括东东农场、京喜工厂、摇钱树等十几个个活动的互助码、互助规则的格式化导出和提交。其中：

a\) 口袋书店已经下线；

b\) 京喜农场已经数月抢不到种子等同于已下线；

c\) 京东赚赚、疯狂的Joy不再支持互助；

d\) 城城领现金、手机狂欢城为购物7节等特殊时期才会上架的活动；

e\) 京喜 Token 自京喜财富岛活动重新上架后已无导出必要。

此外，配合置顶 config.sh 文件，可以实现临时禁止某些 Cookie 参加所有活动或某些活动功能，实现 重组Cookie 顺序功能，包括随机、优先、轮换、组队、分段等功能。

### ● jdCookie.js

适合 CK 数量超过 45 个的用户。

原先的 task_before.sh 直接将互助信息注入到 shell 的 env 中，在 CK 超过 45 个以上时，互助码环境变量过大会导致调用一些系统命令 （如date/cat）时报错 **Argument list too long，即参数字节数过长**。

而在 node 中环境变量不会受这个限制，也不会影响外部shell环境，确保脚本可以正常运行。

**主要功能：**

与 task_before.sh 配合，由 task_before.sh 设置要做互助活动的 ShareCodeConfigName 和 ShareCodeEnvName 环境变量，然后在这里实际解析 **/ql/log/.ShareCode**（由 code.sh 生成和维护） 中该活动对应的配置信息，注入到 nodejs 的环境变量中，突破超长变量字节数限制，以解决 **Argument list too long** 的问题。

### ● config.sample.sh

config.sh 文件的设置样本，集成了大部分脚本的环境变量及配合上面三件套使用的自定义规则。用户可以根据自己的需求进行调整设置，可以通过青龙控制面板中的对比工具进行对比操作。

**小结：**

①code.sh、task_before.sh 和 jdCookie.js 需复制或替换到青龙容器的 /ql/config/ 。针对code.sh，设定定时任务，命令为 task /ql/config/code.sh。

②config.sample.sh 作为默认配置文件 config.sh 的参考模板，用户可凭个人需求参考设定所需的环境变量。

## 一、临时禁止CK

该环境变量可以在 **config_sample.sh** 文件中找到，可以按 Cookie 序号、按 pt_pin(用户名) 两种模式禁止将 Cookie 提交活动脚本。

注意：![临时禁止Cookie](https://raw.githubusercontent.com/Oreomeow/icons/main/HelpCode/TempBlockCookie.jpeg)**全局模式和局部模式可同时生效。但是局部模式的优先级要高于全局模式。**

### 1.1 全局模式

**实现效果：**某个/某些账号不参与所有活动

#### ● 使用按 Cookie 序号方式

**示例1：账号 1、2、5至8、12至19、20位账号均被禁止参加活动，不参加助力活动**

**配置如下:**TempBlockCookie="1,2,5_8,12\~19 20"

**注意：**数字与数字，**数字与区间之间可用 -、\~、\_、空格隔开；**

#### ● 使用按pt_pin(用户名)方式

**示例2：账号“张三”、“jd_13134567890”、“番茄加个蛋”这几个账号均被禁止参加活动**

**配置如下:**TempBlockPin="张三 jd_13134567890,%E7%95%AA%E8%8C%84%E5%8A%A0%E4%B8%AA%E8%9B%8B"

**注意：**各账号间可用 **,** 或**空格**隔开。Cookie 中 pt_pin(用户名) 包含中文的话，是以 url加密编码(%开头的字符编码) 出现的，而本变量中既支持 url加密编码 填写，也支持 url解密编码 的原始中文填写，也就是说，无论填写**%E7%95%AA%E8%8C%84%E5%8A%A0%E4%B8%AA%E8%9B%8B**还是填写**番茄加个蛋**均可。

### 1.2 局部模式

**实现效果：**针对某个或某些脚本单独设定某个/某些账号不参加某项活动。

#### 环境变量介绍

##### ● tempblock_ck_envs_num

正整数。如果填写 3 ，表示 tempblock_ck_envs1 \~ tempblock_ck_envs3 三条多组规则变量生效；

##### ● tempblock_ck_envs1\~tempblock_ck_envs3

代表 3 号规则变量。

赋值：脚本文件名关键词1@禁用账号的序号区间；

脚本文件名关键词2@-@禁用账号的pt_pin。**注意，参数1位置需要加一个 - 作为占位符**

脚本文件名关键词3@禁用账号的序号区间@禁用账号的pt_pin；

脚本文件名关键词4\|脚本文件名关键词5@禁用账号的序号区间@禁用账号的pt_pin。**注意，多脚本共用一个禁用规则，脚本文件名关键词之间采用 \| 分隔；**

脚本文件名关键词6@禁用账号的序号区间@禁用账号的pt_pin&脚本文件名关键词7@禁用账号的序号区间@禁用账号的pt_pin。**注意，多个规则单元之间采用 & 连接；**

#### 示例

##### 示例1：账号 1、3、4、5、7、8、9 不参加东东农场

**配置如下:** tempblock_ck_envs1="jd_fruit@1,3-4,7\~9"

**注意：**这里数字与区间之间可用 -、\~、\_隔开，**不能使用空格隔开；**

##### 示例2：账号名为“张三”的账号不参加金融养猪

**配置如下:** tempblock_ck_envs1="jd_pigPet@-@张三 "

**注意：**按 **pt_pin** 或用户名，张三不参加活动。**注意，参数1位置需要加一个 - 作为占位符**

##### 示例3：账号2、4、5、6、8 以及名称为“张三”的账号不参加种豆得豆

**配置如下:** tempblock_ck_envs1="jd_plantBean@2,4-6,8@张三"

##### 示例4: 所有账号均不参加种豆得豆，假设你有 100 个 CK

**配置如下:** tempblock_ck_envs1="jd_plantBean@1-100"

或者tempblock_ck_envs1="jd_plantBean@1\~100"

##### 示例5：所有账号均参加京喜财富岛

**配置如下：**tempblock_ck_envs1="jd_cfd"

**注意：此配置只填写脚本名称表示相关脚本取消禁止 Cookie 功能，即禁止 Cookie 功能的黑名单。**

**应用场景：**全局变量已设定禁止了某个/某些帐号不参加活动，但针对某些特定脚本仍希望其排除在外，按照所有帐号均可参加活动。如有两个以上活动可以写成

tempblock_ck_envs1="jd_cfd\|jd_fruit"

也可以写成

tempblock_ck_envs1="jd_cfd&fruit"

##### 示例6：想要实现上述所有规则

tempblock_ck_envs1="jd_fruit@1,3-4,7\~9&jd_pigPet@-@张三&jd_plantBean@2,4-6,8@张三&jd_cfd"

**注意：脚本文件名称关键词+参数变量称之为一个规则单元。各个规则单元采用“&”连接**。

如果觉得规则太长，可以自行拆分成多条规则，并且同时将 tempblock_ck_envs_num 写成你要启用的规则数量，例如

tempblock_ck_envs_num="3"

tempblock_ck_envs1="jd_fruit@1,3-4,7\~9&jd_pigPet@-@张三"

tempblock_ck_envs2="jd_plantBean@2,4-6,8@张三"

tempblock_ck_envs3="jd_cfd"

## 二、重组CK

**分为 随机、优先、轮换、组队和分段 5 种模式：其中在全局模式下只有随机、优先、轮换三种，在局部模式下还有组队和分段。**

① **全局模式和局部模式可同时生效，局部模式优先级高于全局模式；**

② 支持黑名单模式(即针对特定脚本不使用任何重组CK的功能，详见 局部模式环境变量 recombin_ck_envs 说明)。

### 2.1 全局模式

#### 介绍

所有账号参与脚本活动的运行模式，有随机、优先和轮换三种模式。

#### 2.1.1 随机模式

##### 介绍

支持自定义从所有 Cookie 中随机抽取若干数量的账号按随机顺序参加活动；

![随机模式](https://raw.githubusercontent.com/Oreomeow/icons/main/HelpCode/RandomMode.jpeg)

##### 环境变量

###### ● Recombin_CK_Mode="1"

① 填 1，表示全局使用随机模式，对全部脚本有效(除非 recombin_ck_envs 另有设定)；

② 若填写 1-3 数字之外的其他内容，则所有账号按正常顺序参加活动(除非 recombin_ck_envs 另有设定)；

###### ● Recombin_CK_ARG1=""

####### 释义：

在随机模式下：表示随意抽取 N 个账号随机顺序参加活动；

####### 赋值要求：

① 填写 大于 0 且小于 Cookie 总数的正整数，对全部脚本有效(除非 recombin_ck_envs 另有设定)；

② 随机模式下：若留空、填写数值 0 或大于等于 Cookie 总数，则所有账号随机顺序参加活动；

示例 js_deps_replace_envs

####### 示例1：假设我有 100 个CK，我希望让所有账号随机助力

Recombin_CK_Mode="1"

Recombin_CK_ARG1="0/100/200" ### 可以写 0 或者任何大于等于 Cookie 总数的整数

或者 Recombin_CK_ARG1=""（不填）

####### 示例2：假设我有 100 个CK，随意抽取 60 个账号随机助力

Recombin_CK_Mode="1"

Recombin_CK_ARG1="60"

##### FAQ

###### 随机模式下，随机出来的 CK 助力是仅仅给选中的 CK 助力，还是为所有 CK 助力？

答：为所有 CK 助力

比如原来一共有 10 个 CK ，且已经通过 code.sh 整理了原始互助码和互助规则(帐号优先模式，帐号1助力 2 3 ... 10，帐号2助力 1 3 ... 10，帐号3助力1 2 4 ... 10)，如果助力到本账号就自动跳过。

例如当本次以随机模式抽取了3个CK，序号和顺序是原 CK 中的 6 2 9 参加活动，则帐号 6 助力原 CK 中 2 3 ... 10，帐号 2 助力原CK中 1 3 ... 10，帐号 9 助力原 CK 中 1 2 4 ... 10。如果账号 6 随机助力到自己，那么则自动跳过，重新随机助力。

#### 2.1.2 优先模式

##### 介绍

支持自定义前若干数量的账号固定按照正常顺序参加活动，其余账号按随机顺序参加活动；

根据 Recombin_CK_ARG1="a" 函数提供的数字，**优先满足账号 1 到 账号 a 的助力**，然后剩余的助力就是随机助力。

![优先模式](https://raw.githubusercontent.com/Oreomeow/icons/main/HelpCode/PriorityMode.jpeg)

##### 环境变量

###### ● Recombin_CK_Mode="2"

① 填 2 表示优先模式，对全部脚本有效(除非 recombin_ck_envs 另有设定)；

② 填下 1-3 数字之外的其他内容，则所有账号按正常顺序参加活动(除非 recombin_ck_envs 另有设定)；

###### ● Recombin_CK_ARG1="a"

① 在优先模式下：表示前 N 个账号固定按正常顺序参加活动

② 填写 大于 0 且小于 Cookie 总数的正整数，对全部脚本有效(除非 recombin_ck_envs 另有设定)；

③ 优先模式下：若填写数值为 0 或大于等于 Cookie 总数，则所有账号按正常顺序参加活动。

##### 示例

###### 示例1：假设我有 100 个CK，所有帐号仍按正常顺序参加活动

Recombin_CK_Mode="2"

Recombin_CK_ARG1="100" 或者 Recombin_CK_ARG1=""（不填）

###### 示例2：假设我有 100 个CK，前 15 个 CK 按正常顺序靠前参加活动，其余的 CK 每次随机乱序参加活动

Recombin_CK_Mode="2"

Recombin_CK_ARG1="15"

##### FAQ

###### 假设 20 个 CK ，填 Recombin_CK_ARG1="30"

答：填写数值大于等于 Cookie 总数，退出模式，所有账号按正常顺序参加活动。

#### 2.1.3 轮换模式

##### 介绍

支持自定义前若干数量的账号固定按照正常顺序参加活动，其余账号按轮换模式参加活动。

从Recombin_CK_ARG1="a" 表示**从账号 1 到 账号 a 始终保持在帐号Cookie队列中的前部**

Recombin_CK_ARG2="b"，这个 b 控制**每天轮换的帐号数量。**

从账号 a+1 到最后一个账号，每月从2号开始进行轮换，**即每天将 b 个账号挪动到 Cookie 队伍末尾 ，也就是**从账号 a+1 开始到账号 a+b 挪到末尾，第二天再将账号 a+b+1 到账号 a+2b 挪到末尾，依次类推。

![轮换模式](https://raw.githubusercontent.com/Oreomeow/icons/main/HelpCode/RotationMode.jpeg)

##### 环境变量

###### ● Recombin_CK_Mode="3"

① 填 3 表示轮换模式，对全部脚本有效(除非 recombin_ck_envs 另有设定)；

②填下 1-3 数字之外的其他内容，则所有账号按正常顺序参加活动(除非 recombin_ck_envs 另有设定)；

###### ● Recombin_CK_ARG1=""

① 在轮换模式下：表示前 N 个账号固定按正常顺序参加活动

② 填写大于 0 或小于 Cookie 总数的正整数，对全部脚本有效(除非 recombin_ck_envs 另有设定)；

③ 轮换模式下：若填写数值为 0 ，表示所有账号参加轮换；若填写数值为大于等于 Cookie 总数，则所有账号切换回正常顺序参加活动；

###### ● Recombin_CK_ARG2=""

① 轮换模式下：表示自定义 N 个账号/天参加轮换，即单次轮换量设定；

② 轮换模式下：只能填不大于参与轮换账号数量(即：总Cookie数量-固定Cookie数量)的正整数；

③ 轮换模式下：若填写为其他内容或留空，则自动调整为按天计算单次轮换量(即：参与轮换账号数量÷当月总天数的商值，取上整数)。如此设计可以确保每个帐号每个月至少有一次机会排到帐号Cookie队伍中前部帐号后相对靠前的位置，享受到更多的助力机会；

##### 示例

###### 示例1:我有 100 个 CK，所有账号参与轮换，每天只轮换 1 个 CK

Recombin_CK_Mode="3"

Recombin_CK_ARG1="0"

Recombin_CK_ARG2="1"

###### 示例2：我有 100 个 CK，所有账号参与，每天轮换 4 个 CK

Recombin_CK_Mode="3"

Recombin_CK_ARG1="0"

Recombin_CK_ARG2="4"

###### 示例3：我有 100 个 CK，我希望前 5 个账号始终保持在前部，剩余 95 个账号按照轮换模式每天轮换 5 个

Recombin_CK_Mode="3"

Recombin_CK_ARG1="5"

Recombin_CK_ARG2="5"

##### FAQ

###### 假设 Recombin_CK_ARG2="" 这个留空，怎么计算？

答：计算公式为：**参与轮换账号数量÷当月总天数的商值**，**取上整数**。

假设除去锁定前部的帐号后还有 8 个 CK 参与轮换，本月有 30 天，则计算： 8/30=0.26 则向上取整数 1，也就是每天轮换 1 个 CK

假设除去锁定前部的账号后还有 60 个 CK 参与轮换，本月有 30 天，则计算： 60/30=2 则向上取整数 2，也就是每天轮换 2 个 CK

假设除去锁定前部的账号后还有 100 个 CK 参与轮换，本月有 28 天，则计算：100/28=3.57 则向上取整数 4，也就是每天轮换 4 个 CK

### 2.2 局部模式

#### 介绍

在全局模式之外，可以针对某个脚本运行某种模式。全局模式和局部模式可以同时生效，**局部模式优先级高于全局模式。**例如，我全局是按照优先模式进行的，但是在参加“组队瓜分京豆”脚本的时候可以按照组队模式进行。

局部模式下除了随机模式、优先模式和轮换模式之外，还支持组队模式和分段模式.

#### 2.2.1 局部模式下填写规则

##### 环境变量

###### ● recombin_ck_envs_num="3"

局部模式环境变量的启用数量

赋值要求：正整数。

如果填写 3 ，表示 recombin_ck_envs1 \~ recombin_ck_envs3 生效；

###### ● recombin_ck_envs1="" recombin_ck_envs2="" recombin_ck_envs3=""

可以自由定义多组局部模式环境变量；

##### 赋值介绍释义

####### 单脚本规则单元：脚本1文件名关键词@模式@参数1@参数2@参数3@参数4@参数5；

####### 两个及以上脚本共享一套规则单元：脚本1文件名关键词\|脚本2文件名关键词@模式@参数1@参数2@参数3@参数4@参数5。多脚本共用一套规则单元时，脚本文件名关键词之间采用\|分隔符。

① 脚本文件名关键词

例如，东东农场的活动脚本关键词 jd_fruit，支持某个作者的脚本通配符模糊匹配，例如：ccwav\*jd_fruit表示只对ccwav的jd_fruit脚本生效。多个脚本关键词采用 \| 符号分隔。例如：jd_fruit\|jd_dreamFactory；

② **脚本文件名关键词与各参数采用 @ 连接。**

释义附后。如果不设定参数1，表示该脚本按正常账号顺序参加活动(即：黑名单)；

③ 模式。表示 Recombin_CK_Mode；

④ 参数1。表示 Recombin_CK_ARG1；

⑤ 参数2。表示 Recombin_CK_ARG2；

⑥ 参数3。表示 Recombin_CK_ARG3；组队模式、分段模式：表示各分段启动活动脚本的延隔时间，即第一组（或段）CK 开始运行脚本后，等待特定时间下一组（或段）启动脚本。支持 d(天)、h(小时)、m（分钟）、s(秒。可略写)。如 1d2h3m4s 表示 1天2小时3分钟4秒；

⑦ 参数4。表示 Recombin_CK_ARG4；组队模式、分段模式：表示各分段启动活动脚本的间隔时间，即第一组（或段）CK 完成运行脚本后，等待特定时间下一组（或段）启动脚本。需参数3为 - 占位符时生效。支持 d(天)、h(小时)、m（分钟）、s(秒。可略写)。如 1d2h3m4s 表示 1天2小时3分钟4秒；

⑧ 参数5。表示 Recombin_CK_ARG5；组队瓜分京豆脚本 (jd_zdjr) ：表示调用 activity_env 变量组(用法附后)的指定环境变量。例如，填 0，表示所有变量执行一次，填 1 表示只调用第 1 组变量。需参数1、参数2 为 - 占位符时生效；

⑨ 各个规则单元之间采用 & 连接。可以针对同一脚本设置多个规则单元，以实现模式迭代组合。当多次变量遇到组队或分段模式时，终止迭代，即：随机、优先、轮换三者间可以无限迭代；这三者与组队、分段其中之一实现单轮迭代；

#### 2.2.2 随机模式

##### 介绍

请参考上文

##### 示例

###### 示例1：假设有 100 个 CK，东东农场和京喜工厂采用随机模式，抽 5 个 CK 顺序随机

recombin_ck_envs1="jd_fruit\|jd_dreamFactory@1@5"

#### 2.2.3 优先模式

##### 介绍

请参考上文

##### 示例

###### 示例2：假设有 100 个 CK，东东萌宠采用优先模式，前 6 个 CK 顺序优先，其余 CK 顺序随机

recombin_ck_envs1="jd_pet@2@6"

#### 2.2.4 轮换模式

##### 介绍

请参考上文

##### 示例

###### 示例3：假设有 100 个 CK，金融养猪采用轮换模式，前 5 个 CK 顺序固定，根据 CK 总数（100）和当月天数（例如 30）自动计算每天轮换 CK 数量（100-5)/30=3.1，取上整数4）

recombin_ck_envs1="jd_pigPet@3@5"

###### 示例4：假设有 100 个 CK，金融养猪采用轮换模式，前 5 个 CK 顺序固定，然后每天 10 个账号参与轮换

recombin_ck_envs1="jd_pigPet@3@5@10"

#### 2.2.5 组队模式

##### 介绍

**只支持 js 脚本。**根据游戏规则每支队伍的成员数量、每个账号能发起的组队次数上限自动按顺序参加活动。**特别针对京东组队瓜分京豆这项活动。**

![组队模式-局部模式](https://raw.githubusercontent.com/Oreomeow/icons/main/HelpCode/Group&LocalMode.jpeg)

##### 环境变量

###### ● Recombin_CK_Mode="4"

① 填 4 表示组队模式，对全部脚本有效(除非 recombin_ck_envs 另有设定)；

②填下 1-5 数字之外的其他内容，则所有账号按正常顺序参加活动(除非 recombin_ck_envs 另有设定)；

###### ● Recombin_CK_ARG1=""

① 在组队模式下：表示每支队伍的成员数量；

② 填写大于 0 或小于 Cookie 总数的正整数，对全部脚本有效(除非 recombin_ck_envs 另有设定)；

③ 组队模式下：若填写数值为 0 或其他内容，则所有账号切换回正常顺序参加活动。

###### ● Recombin_CK_ARG2=""

① 在组队模式下：表示每个账号发起组队的次数；

② 组队模式下：若填写为其他内容或留空，则全部账号切换回正常顺序参加活动。

###### ● Recombin_CK_ARG3=""

① 表示各分段启动活动脚本的延隔时间，支持 d(天)、h(小时)、m（分钟）、s(秒可略写)。如 1d2h3m4s 表示 1天2小时3分钟4秒；

###### ● Recombin_CK_ARG4=""

① 表示各分段启动活动脚本的间隔时间。需参数3为 - 占位符时生效；

###### ● Recombin_CK_ARG5=""

组队瓜分京豆脚本 (jd_zdjr) ：表示调用 activity_env 变量组(用法附后)的指定环境变量。例如，填 0，表示所有变量执行一次，填 1 表示只调用第 1 组变量。需参数1、参数2 为 - 占位符时生效；

###### ● 组队瓜分京豆环境变量组

####### 释义：

用于自定义多组 activityId 和 activityUrl；由参数5控制

####### 赋值要求：

详见示例：

activity_env=(

5@3@48a4106275f24bb7871e396fcf39d767@<https://lzkjdz-isv.isvjcloud.com>

teamer_num@team_num@activityId2@activityUrl2 \# 第 2 组环境变量

teamer_num@team_num@activityId3@activityUrl3 \# 第 3 组环境变量

teamer_num@team_num@activityId4@activityUrl4 \# 第 4 组环境变量

)

注释：每组变量前两个参数表示 几 人成队，每个账号最多发起 几 次组队；后两个参数表示组队瓜分京豆活动的 ID 和 链接。参数之间采用 @ 连接；

##### 示例

###### 示例5：假设我有 100 个 CK，iroyway 的组队瓜分京豆脚本采用组队模式，队伍成员数量 80，每个账号组队 1 次，每组账号队伍并发进行

recombin_ck_envs1="iroyway\*zdjr@4@80@1"

###### 示例6：假设我有 100 个 CK，iroyway 的组队瓜分京豆脚本采用组队模式，队伍成员数量 80，每个账号组队 1 次，每组账号队伍延隔 15 秒进行

recombin_ck_envs1="iroyway\*zdjr@4@80@1@15"

###### 示例7：假设我有 100 个 CK，iroyway 的组队瓜分京豆脚本采用组队模式，队伍成员数量 80，每个账号组队 1 次，每组账号队伍间隔 15 秒进行

recombin_ck_envs1="iroyway\*zdjr@4@80@1@-@15"

###### 示例8：假设我有 100 个 CK，iroyway 的组队瓜分京豆脚本采用组队模式，调用第三组环境变量

recombin_ck_envs2="iroyway\*zdjr@4@-@-@-@-@3"

##### FAQ

###### 1.在组队模式中，各个帐号的参与顺序是怎样的？

答：排位靠前的CK具备优先发起组队权利，1 号 CK 也会成为 2 号 CK 的第一支队伍的组员。按分组顺序依次排列，直到最后一名CK完成参队为止。但由于帐号数量和总组队数量可能无法与活动规则刚好契合，所以可能出现最后一队无法完整组队的情况。

例1：20个帐号，每个账号可以发起1次组队，每支队伍满5人；

1 2 3 4 5

2 1 6 7 8

3 9 10 11 12

4 13 14 15 16

5 17 18 19 20

例2：20个帐号，每个账号可以发起2次组队，每支队伍满5人；

1 2 3 4 5

1 6 7 8 9

2 1 10 11 12

2 13 14 15 16

3 17 18 19 20

例3：20个帐号，每个账号可以发起3次组队，每支队伍满5人；

1 2 3 4 5

1 6 7 8 9

1 10 11 12 13

2 1 14 15 16

2 17 18 19 20

#### 2.2.6 分段模式

##### 介绍

**只支持 js 脚本。**支持自定义按若干数量拆分账号，按分段顺序参加活动。支持各段并发、延隔、间隔启动活动脚本。

假设我有 100 个 CK，分段模式中 Recombin_CK_ARG2="b" 就是**相当于每个分段的数量**，例如 b=20 就是相当于将 100 个 CK 分成 5 （100/20）段，每段的数量为 20 个。

然后划分的分段可以看成一个优先模式， Recombin_CK_ARG1="a" 这里的 “a” 控制**每个分段优先排序**，假如 a=5，就代表着原CK队伍中的前5个CK始终锁定顺序并参与到每个分段的前5个CK。

在全局模式下，默认所有分段按顺序参加活动，即上一段完成活动后再启动下一段。

![分段模式-局部模式](https://raw.githubusercontent.com/Oreomeow/icons/main/HelpCode/Segmented&LocalMode.jpeg)

##### 环境变量

###### ● Recombin_CK_Mode="5"

① 填 5 表示分段模式，对全部脚本有效(除非 recombin_ck_envs 另有设定)；

② 若填写为其他内容，则所有账号按正常顺序参加活动(除非 recombin_ck_envs 另有设定)；

###### ● Recombin_CK_ARG1=""

① 在分段模式下：表示前 N 个账号固定按正常顺序参加活动；

② 分段模式下：若填写数值为 0 ，表示所有账号参与分段；若填写数值为大于等于 Cookie 总数，则所有账号切换回正常顺序参加活动；

###### ● Recombin_CK_ARG2=""

① 在分段模式下：表示每个分段的账号数量；

② 分段模式下：只能填大于固定账号数量且不大于 Cookie 总数的数值。若填写为其他内容或留空，则全部账号切换回正常顺序参加活动。

###### ● Recombin_CK_ARG3=""

① 表示各分段启动活动脚本的延隔时间，支持 d(天)、h(小时)、m（分钟）、s(秒可略写)。如 1d2h3m4s 表示 1天2小时3分钟4秒；

###### ● Recombin_CK_ARG4=""

① 表示各分段启动活动脚本的间隔时间。需参数3为 - 占位符时生效；

##### 示例

###### 示例9：假设我有 100 个CK，东东健康采用分段模式，每段**前 4 个CK顺序固定**，每段成员数量 8，会分成 100/8各分段依次执行启动脚本

recombin_ck_envs1="jd_health@5@4@8"

并发执行脚本

recombin_ck_envs1="jd_health@5@4@8@0"

###### 示例10：假设我有 100 个CK，东东健康使用分段模式：每段**前 4 个CK顺序固定**，每段成员数量8，每段启动脚本的延隔时间为 15 秒，即本段开始启动脚本后 15 秒，下一段启动脚本。第 4 个参数表示每个分段启动活动脚本的延隔时间，单位：秒

recombin_ck_envs1="jd_health@5@4@8@15（s，可以略写）"

###### 示例11：假设我有 100 个CK，东东健康使用分段模式：每段**前 4 个CK顺序固定**，每段成员数量8，每段启动脚本的延隔时间为 1 小时 23 分钟，即本段开始启动脚本后 1 小时 23 分钟，下一段启动脚本。参数3 表示每个分段启动活动脚本的延隔时间，单位：默认为s(秒)，也可以填d(天)、h(小时)、m(分钟)。支持时间混填

recombin_ck_envs1="jd_health@5@4@8@1h23m"

或者

recombin_ck_envs1="jd_health@5@4@8@83m"

或者

recombin_ck_envs1="jd_health@5@4@8@4980（s，可以略写）"

###### 示例12：假设我有 100 个CK，ccwav 的 speed_sign （京东极速版任务）脚本。使用分段模式：所有账号（100个）参与分段，每段成员数量20，每段启动脚本的间隔时间为 5400 秒即本段脚本执行完成后，等待 5400 秒，下一段启动脚本。当参数3 使用 - 占位符时，参数4 表示每个分段启动活动脚本的间隔时间，单位：默认为s(秒)，也可以填d(天)、h(小时)、m(分钟)。支持时间混填

recombin_ck_envs1="ccwav\*speed_sign@5@0@20@-@5400"

###### 示例13：假设我有 100 个CK，宠汪汪兑换脚本采用分段模式，没有固定前部账号，每段成员数量 10，各分段并发执行启动脚本

recombin_ck_envs6="jd_joy_reward@5@0@10@0"

##### FAQ

###### 全局模式下如何实现并发、延隔、间隔？

答：不考虑全局模式下的并发、延隔、间隔

###### 分段的计算公式是什么？

答：分段数=(CK总数-前部帐号数)/(分段帐号数-前部帐号数)，上取整

###### 假如 a \>b 怎么办？也就是我有 100 个 CK，我划分每段数量为 8 （b）个 但我设置每个分段固定顺序数量为 10（a），这会怎么办？

答：提示并退出模式，全部帐号按正常顺序参与活动。

###### 局部模式下并发和延隔的默认线程数量是多少？

答：**并发：**分多少组(段)，就有多少线程

**延隔：**看启动时，最上一段有没有运行完

###### 可以 a = b 吗？也就是我有 100 个 CK，我划分每段数量为 8 （b）个 但我设置每个分段固定顺序数量为 8（a），这会怎么办？

答：不行。参数 1（a） 是固定前部的账号数量，参数 2（b）是一个分段的最大帐号数量。如果参数 2（b）等于参数 1 （a）了，分不了段了

#### 2.2.7 局部模式的效果迭代

**注意：脚本文件名称关键词+参数变量称之为一个规则单元。各个规则单元采用“&”连接**。

如果觉得规则太长，可以自行拆分成多条规则，并且同时将 recombin_ck_num 写成你要启用的规则数量，例如

recombin_ck_num="3"

recombin_ck_envs1="jd_fruit\|jd_dreamFactory@1@5"

recombin_ck_envs2="jd_pet@2@6&jd_pigPet@3@5&jd_plantBean@3@7@4"

recombin_ck_envs3="ccwav\*speed_sign@5@0@20@-@5400&iroyway\*zdjr@3@5&iroyway\*zdjr@4@5@4@-@-@1"

##### 示例13：假设我有 100 个CK，iroyway 的组队瓜分京豆脚本使用先轮换，前 5 个 CK 顺序固定，根据 CK 总数（100）和当月天数（例如 30）自动计算每天轮换 CK 数量（100/30=3.3，取整数3），然后再组队模式，队伍成员数量为 5 个，每个账号组队 4 次，每段启动脚本的间隔时间为 1 秒即本段脚本执行完成后，等待 1 秒，下一段启动脚本

recombin_ck_envs1="iroyway\*zdjr@3@5&iroyway\*zdjr@4@5@4@-@1"
